FROM golang:1.21

ARG ENVIRONMENT
ENV ENVIRONMENT=$ENVIRONMENT

ARG COMMUNITY_NAME
ENV COMMUNITY_NAME=$COMMUNITY_NAME

ARG LOKI_URL
ENV LOKI_URL=$LOKI_URL

ARG DB_URL
ENV DB_URL=$DB_URL

ARG TELEGRAM_AUTHORIZATION_BOT_TOKEN
ENV TELEGRAM_AUTHORIZATION_BOT_TOKEN=$TELEGRAM_AUTHORIZATION_BOT_TOKEN

ARG DISCORD_AUTHORIZATION_BOT_TOKEN
ENV DISCORD_AUTHORIZATION_BOT_TOKEN=$DISCORD_AUTHORIZATION_BOT_TOKEN

ARG DISCORD_AUTHORIZATION_CHANNEL_ID
ENV DISCORD_AUTHORIZATION_CHANNEL_ID=$DISCORD_AUTHORIZATION_CHANNEL_ID

WORKDIR /opt/src

COPY ./go.mod .
COPY ./go.sum .
RUN go mod download

ADD . .

RUN go build -o /go/bin/app ./cmd/authorization_bot/

CMD ["/go/bin/app"]