FROM golang:1.21

ARG ENVIRONMENT
ENV ENVIRONMENT=$ENVIRONMENT

ARG LOKI_URL
ENV LOKI_URL=$LOKI_URL

ARG DB_URL
ENV DB_URL=$DB_URL

ARG QUORUM
ENV QUORUM=$QUORUM

ARG MAX_REQUIRED_SEEDERS_COUNT
ENV MAX_REQUIRED_SEEDERS_COUNT=$MAX_REQUIRED_SEEDERS_COUNT

ARG YES_VOTES_TO_OVERCOME_NO
ENV YES_VOTES_TO_OVERCOME_NO=$YES_VOTES_TO_OVERCOME_NO

ARG MIN_YES_VOTES_PERCENTAGE
ENV MIN_YES_VOTES_PERCENTAGE=$MIN_YES_VOTES_PERCENTAGE

ARG MIN_REQUIRED_YES_VOTES
ENV MIN_REQUIRED_YES_VOTES=$MIN_REQUIRED_YES_VOTES

ARG TELEGRAM_ACCESS_GOVERNANCE_BOT_TOKEN
ENV TELEGRAM_ACCESS_GOVERNANCE_BOT_TOKEN=$TELEGRAM_ACCESS_GOVERNANCE_BOT_TOKEN

ARG MEMBERS_CHAT_ID
ENV MEMBERS_CHAT_ID=$MEMBERS_CHAT_ID

ARG SEEDERS_CHAT_ID
ENV SEEDERS_CHAT_ID=$SEEDERS_CHAT_ID

WORKDIR /opt/src

COPY ./go.mod .
COPY ./go.sum .
RUN go mod download

ADD . .

RUN go build -o /go/bin/app ./cmd/proposal_state_service/

CMD ["/go/bin/app"]