FROM golang:1.21

ARG ENVIRONMENT
ENV ENVIRONMENT=$ENVIRONMENT

ARG COMMUNITY_NAME
ENV COMMUNITY_NAME=$COMMUNITY_NAME

ARG INITIAL_SEEDERS
ENV INITIAL_SEEDERS=$INITIAL_SEEDERS

ARG RENOMINATION_PERIOD_DAYS
ENV RENOMINATION_PERIOD_DAYS=$RENOMINATION_PERIOD_DAYS

ARG VOTING_DURATION_DAYS
ENV VOTING_DURATION_DAYS=$VOTING_DURATION_DAYS

ARG LOKI_URL
ENV LOKI_URL=$LOKI_URL

ARG DB_URL
ENV DB_URL=$DB_URL

ARG TELEGRAM_ACCESS_GOVERNANCE_BOT_TOKEN
ENV TELEGRAM_ACCESS_GOVERNANCE_BOT_TOKEN=$TELEGRAM_ACCESS_GOVERNANCE_BOT_TOKEN

ARG TELEGRAM_VOTE_BOT_TOKEN
ENV TELEGRAM_VOTE_BOT_TOKEN=$TELEGRAM_VOTE_BOT_TOKEN

ARG MEMBERS_CHAT_ID
ENV MEMBERS_CHAT_ID=$MEMBERS_CHAT_ID

ARG SEEDERS_CHAT_ID
ENV SEEDERS_CHAT_ID=$SEEDERS_CHAT_ID

WORKDIR /opt/src

COPY ./go.mod .
COPY ./go.sum .
RUN go mod download

ADD . .

RUN go build -o /go/bin/app ./cmd/access_governance_bot/

CMD ["/go/bin/app"]